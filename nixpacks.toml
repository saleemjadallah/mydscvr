[phases.setup]
# Use Node.js 20 for canvas compatibility (no prebuilt binaries for v22)
nixPkgs = ["nodejs_20", "python3"]

# Native dependencies for canvas, sharp, and pdf processing
# Using nixLibs adds these to LD_LIBRARY_PATH at runtime
nixLibs = [
  "pkg-config",
  "cairo",
  "pango",
  "libpng",
  "libjpeg",
  "giflib",
  "librsvg",
  "libuuid",
  "pixman"
]

[phases.install]
cmds = ["cd backend && npm ci"]

[phases.build]
cmds = ["cd backend && npm run build"]

[phases.start]
# IMPORTANT: Removed db:push from start command
# db:push is interactive and blocks deployment
# Run migrations manually or via separate Railway service/job
cmd = "cd backend && npm start"
