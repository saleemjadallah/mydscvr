[phases.setup]
nixPkgs = [
  # Tooling to build native Node deps and runtime libs for canvas/sharp
  "nodejs_18",  # includes npm
  "python3",
  "gnumake",
  "gcc",
  "pkg-config",
  "cairo",
  "pango",
  "libpng",
  "libjpeg",
  "giflib",
  "librsvg",
  "libuuid",
  "util-linux"
]

[phases.install]
cmds = ["cd backend && npm ci"]

[phases.build]
cmds = ["cd backend && npm run build"]

[phases.start]
cmd = "cd backend && npm run db:push && npm start"
